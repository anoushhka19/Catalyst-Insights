<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relaxed Energy Prediction</title>
    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.0/3Dmol-min.js"></script>
</head>
<body>
<!-- Navbar -->
<nav class="navbar">
  <div class="nav-container">
    <div class="nav-left">
      <a href="{{url_for('home')}}" id="home-tab">Home</a>
      <a href="{{url_for('history_page')}}" id="history-tab">History</a>
      <a href="{{url_for('compare')}}" id="compare-tab">Screen Relaxed Structures</a>
    </div>
    <div class="nav-right">
      <a href="{{url_for('index')}}" id="logout-tab">Logout</a>
    </div>
  </div>
</nav>

<div id="history-section" class="container hidden">
    <h1>Prediction History</h1>
    <table id="history-table" border="1">
      <thead>
        <tr>
          <th>File Name</th>
          <th>Predicted Energy</th>
          <th>Timestamp</th>
            <th>Delete</th>
        </tr>
      </thead>
      <tbody>
        <!-- History rows will be populated here -->
      </tbody>
    </table>
</div>

<script src="static/js/script.js"></script>
<script>
    // Fetch history data and populate the table
    fetch('/history')
        .then(response => response.json())
        .then(data => {
            const tableBody = document.querySelector('#history-table tbody');
            data.forEach(entry => {
                const row = document.createElement('tr');
                row.innerHTML = `

                    <td><a href="/static/uploads/${entry.file_name}" download>${entry.file_name}</a></td>
                    <td>${entry.predicted_energy}</td>
                    <td>${entry.timestamp}</td>
                    <td><button class="delete-btn" data-id="${entry.id}"><i class="material-icons">delete</i></button></td>
                `;
                tableBody.appendChild(row);

                // Add event listener for delete button
                const deleteButton = row.querySelector('.delete-btn');
                deleteButton.addEventListener('click', () => {
                    const entryId = deleteButton.dataset.id;
                    if (confirm("Are you sure you want to delete this entry?")) { // Confirmation
                        fetch(`/history/${entryId}`, { method: 'DELETE' })
                            .then(response => {
                                if (response.ok) {
                                    row.remove(); // Remove row from table
                                    console.log('Entry deleted successfully');
                                } else {
                                    return response.json().then(err => {throw new Error(err.error || 'Failed to delete entry')});
                                }
                            })
                            .catch(error => {
                                console.error('Error deleting entry:', error);
                                alert(error); // Show error message to the user
                            });
                    }
                });


            });
        })
        .catch(error => console.error('Error fetching history:', error));
</script>

</body>
</html>